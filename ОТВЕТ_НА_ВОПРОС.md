# ‚ùì –ë–æ—Ç –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ - –†–µ—à–µ–Ω–∏–µ

> **–í–∞—à –≤–æ–ø—Ä–æ—Å:** "–ù–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ë–æ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∫–∞–∫–∏–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–∏—á–∏–Ω—ã –∏ —á—Ç–æ —Å–¥–µ–ª–∞—Ç—å"

---

## ‚ö° –ë–´–°–¢–†–û–ï –†–ï–®–ï–ù–ò–ï

### –û–¥–∏–Ω —Å–∫—Ä–∏–ø—Ç - —Ä–µ—à–∞–µ—Ç –≤—Å—ë –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

```bash
ssh user@–≤–∞—à_IP
cd ~/telegram_repair_bot
bash scripts/update_bot.sh
```

**–ì–æ—Ç–æ–≤–æ!** ‚úÖ

---

## üîç –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ - –∑–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:

```bash
bash scripts/diagnose_update.sh
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç –≤—Å—ë –∏ —Å–∫–∞–∂–µ—Ç, –≤ —á—ë–º –ø—Ä–æ–±–ª–µ–º–∞.

---

## üìã –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã (–¢–û–ü-10)

| # | –ü—Ä–∏—á–∏–Ω–∞ | –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ |
|---|---------|-----------------|
| 1 | –ö–æ–¥ –Ω–µ –æ–±–Ω–æ–≤–ª—ë–Ω | `git pull origin main` |
| 2 | Docker –Ω–µ –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω | `docker compose build --no-cache` |
| 3 | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω | `docker compose down && up -d` |
| 4 | .env –Ω–µ –æ–±–Ω–æ–≤–ª—ë–Ω | `nano .env` (–¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ) |
| 5 | –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã | `alembic upgrade head` |
| 6 | –°—Ç–∞—Ä—ã–π –∫—ç—à | –ò—Å–ø–æ–ª—å–∑—É–π `--no-cache` |
| 7 | Systemd –º–µ—à–∞–µ—Ç | `systemctl stop telegram-bot` –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º |
| 8 | –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ | `chown -R $USER:$USER ~/telegram_repair_bot` |
| 9 | Redis –ø—Ä–æ–±–ª–µ–º—ã | `docker compose restart redis` |
| 10 | Volumes —É—Å—Ç–∞—Ä–µ–ª–∏ | `down && up -d --force-recreate` |

---

## üìñ –ì–¥–µ –Ω–∞–π—Ç–∏ –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é?

### üî• –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è:
‚ûú **[–ë–´–°–¢–†–û–ï_–û–ë–ù–û–í–õ–ï–ù–ò–ï.md](–ë–´–°–¢–†–û–ï_–û–ë–ù–û–í–õ–ï–ù–ò–ï.md)** - –æ–¥–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞

‚ûú **[docs/troubleshooting/–û–ë–ù–û–í–õ–ï–ù–ò–ï_–ë–û–¢–ê_–ö–†–ê–¢–ö–û.md](docs/troubleshooting/–û–ë–ù–û–í–õ–ï–ù–ò–ï_–ë–û–¢–ê_–ö–†–ê–¢–ö–û.md)** - –≤—Å–µ —Ä–µ—à–µ–Ω–∏—è

### üìö –î–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è:
‚ûú **[docs/troubleshooting/BOT_UPDATE_ISSUES.md](docs/troubleshooting/BOT_UPDATE_ISSUES.md)** - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ (10+ –ø—Ä–∏—á–∏–Ω)

‚ûú **[docs/troubleshooting/–†–ï–ó–Æ–ú–ï_–û–ë–ù–û–í–õ–ï–ù–ò–Ø_–î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–ò.md](docs/troubleshooting/–†–ï–ó–Æ–ú–ï_–û–ë–ù–û–í–õ–ï–ù–ò–Ø_–î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–ò.md)** - —á—Ç–æ —Å–æ–∑–¥–∞–Ω–æ

---

## üõ†Ô∏è –ß—Ç–æ –±—ã–ª–æ —Å–æ–∑–¥–∞–Ω–æ –¥–ª—è –≤–∞—Å:

### üìÑ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (7 —Ñ–∞–π–ª–æ–≤)
- –ö—Ä–∞—Ç–∫–∏–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –≥–∞–π–¥—ã  
- FAQ –∏ troubleshooting

### ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã (2 —Å–∫—Ä–∏–ø—Ç–∞)
- **update_bot.sh** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- **diagnose_update.sh** - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### ‚úÖ –í—Å—ë –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!

---

## üöÄ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
bash scripts/update_bot.sh
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í—Ä—É—á–Ω—É—é (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª—å)

```bash
# 1. Backup
cp data/bot_database.db backups/backup_$(date +%Y%m%d_%H%M%S).db

# 2. –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker compose -f docker/docker-compose.prod.yml down

# 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
git pull origin main

# 4. –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –ë–ï–ó –∫—ç—à–∞
docker compose -f docker/docker-compose.prod.yml build --no-cache

# 5. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
docker compose -f docker/docker-compose.prod.yml run --rm bot alembic upgrade head

# 6. –ó–∞–ø—É—Å–∫
docker compose -f docker/docker-compose.prod.yml up -d

# 7. –ü—Ä–æ–≤–µ—Ä–∫–∞
docker compose -f docker/docker-compose.prod.yml logs -f bot
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

```bash
# –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω?
docker ps | grep telegram

# –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö?
docker compose -f docker/docker-compose.prod.yml logs --tail=50 bot | grep -i error

# –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç?
# –û—Ç–ø—Ä–∞–≤—å—Ç–µ /start –≤ Telegram
```

---

## üÜò –°–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### "git pull —Å–¥–µ–ª–∞–ª, –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å"
```bash
# Docker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–∑
docker compose -f docker/docker-compose.prod.yml build --no-cache
docker compose -f docker/docker-compose.prod.yml up -d --force-recreate
```

### "Database is locked"
```bash
docker compose -f docker/docker-compose.prod.yml down
rm -f data/bot_database.db-journal data/bot_database.db-shm data/bot_database.db-wal
docker compose -f docker/docker-compose.prod.yml up -d
```

### "Permission denied"
```bash
sudo chown -R $USER:$USER ~/telegram_repair_bot/
chmod 755 ~/telegram_repair_bot/data
chmod 600 ~/telegram_repair_bot/.env
```

---

## üí° –í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

1. ‚úÖ **–í–°–ï–ì–î–ê** –¥–µ–ª–∞–π—Ç–µ backup –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
2. ‚úÖ **–í–°–ï–ì–î–ê** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--no-cache` –ø—Ä–∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ
3. ‚úÖ **–ü–†–û–í–ï–†–Ø–ô–¢–ï** –ª–æ–≥–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
4. ‚úÖ **–¢–ï–°–¢–ò–†–£–ô–¢–ï** –±–æ—Ç–∞ –≤ Telegram

---

## üéØ –ö—É–¥–∞ –∏–¥—Ç–∏ –¥–∞–ª—å—à–µ?

### –ü—Ä—è–º–æ —Å–µ–π—á–∞—Å:
1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É: `ssh user@IP`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: `bash scripts/update_bot.sh`
3. –ì–æ—Ç–æ–≤–æ!

### –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: `bash scripts/diagnose_update.sh`
2. –°–ª–µ–¥—É–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º —Å–∫—Ä–∏–ø—Ç–∞
3. –ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ: **[docs/troubleshooting/BOT_UPDATE_ISSUES.md](docs/troubleshooting/BOT_UPDATE_ISSUES.md)**

### –î–ª—è –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∏:
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ backup (—Å–º. **scripts/README.md**)
- –ò–∑—É—á–∏—Ç–µ –≤—Å–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º (—Å–º. **BOT_UPDATE_ISSUES.md**)

---

## üìû –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–º–æ—â–∏

```
‚ùì –ü—Ä–æ–±–ª–µ–º–∞: –ë–æ—Ç –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
    ‚îÇ
    ‚îú‚îÄ üöÄ –ë–´–°–¢–†–û: bash scripts/update_bot.sh
    ‚îÇ
    ‚îú‚îÄ üîç –ù–ï –ü–û–ú–û–ì–õ–û: bash scripts/diagnose_update.sh
    ‚îÇ
    ‚îú‚îÄ üìñ –ß–ò–¢–ê–¢–¨: –û–ë–ù–û–í–õ–ï–ù–ò–ï_–ë–û–¢–ê_–ö–†–ê–¢–ö–û.md
    ‚îÇ
    ‚îî‚îÄ üìö –ì–õ–£–ë–û–ö–û: BOT_UPDATE_ISSUES.md
```

---

## ‚è±Ô∏è –í—Ä–µ–º—è —Ä–µ—à–µ–Ω–∏—è

- **–° –∞–≤—Ç–æ—Å–∫—Ä–∏–ø—Ç–æ–º:** 2-3 –º–∏–Ω—É—Ç—ã
- **–í—Ä—É—á–Ω—É—é:** 5-10 –º–∏–Ω—É—Ç  
- **–° –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π:** 10-15 –º–∏–Ω—É—Ç

---

## üéâ –ò—Ç–æ–≥

**–£ –≤–∞—Å —Ç–µ–ø–µ—Ä—å –µ—Å—Ç—å:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –°–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –ì–æ—Ç–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è

**–ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ:**
- ‚ùå –ò—Å–∫–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –≤ –∏—Å—Ç–æ—Ä–∏–∏
- ‚ùå –ì—É–≥–ª–∏—Ç—å –æ—à–∏–±–∫–∏
- ‚ùå –†–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑ –∑–∞–Ω–æ–≤–æ

**–ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:**
```bash
bash scripts/update_bot.sh
```

---

**–î–∞—Ç–∞:** 15 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

üí™ **–£—Å–ø–µ—à–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π!**

