# üì¶ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–º—É –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –°–ø–æ—Å–æ–± 1: Python-—Å–∫—Ä–∏–ø—Ç (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) üåü

```powershell
python backup_db.py
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ö—Ä–∞—Å–∏–≤—ã–π –≤—ã–≤–æ–¥
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ë–î
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –∫–æ–ø–∏–∏ (>30 –¥–Ω–µ–π)
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∫–æ–ø–∏–π

### –°–ø–æ—Å–æ–± 2: PowerShell-—Å–∫—Ä–∏–ø—Ç

```powershell
.\backup_db.ps1
```

### –°–ø–æ—Å–æ–± 3: –í—Ä—É—á–Ω—É—é (–æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π)

```powershell
Copy-Item bot_database.db -Destination "bot_database_backup_$(Get-Date -Format 'yyyy-MM-dd').db"
```

---

## üìã –ß—Ç–æ –¥–µ–ª–∞—é—Ç —Å–∫—Ä–∏–ø—Ç—ã

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ø–∏–∏
- –ö–æ–ø–∏—Ä—É—é—Ç `bot_database.db` –≤ –ø–∞–ø–∫—É `backups/`
- –ò–º—è —Ñ–∞–π–ª–∞: `bot_database_–ì–ì–ì–ì-–ú–ú-–î–î_–ß–ß-–ú–ú-–°–°.db`
- –ü—Ä–∏–º–µ—Ä: `bot_database_2025-10-12_15-43-55.db`

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
- –£–¥–∞–ª—è—é—Ç –∫–æ–ø–∏–∏ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
- –≠—Ç–æ —ç–∫–æ–Ω–æ–º–∏—Ç –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ

### 3. –û—Ç—á–µ—Ç
- –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–∞–∑–º–µ—Ä –ë–î
- –°–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∫–æ–ø–∏–π
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

---

## üéØ –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:
- ‚úÖ **–ü–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –±–æ—Ç–∞**
- ‚úÖ **–ü–µ—Ä–µ–¥ —Ä—É—á–Ω—ã–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ë–î**
- ‚úÖ **–ü–µ—Ä–µ–¥ –º–∞—Å—Å–æ–≤—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏** (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- ‚úÖ **–ü–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π** –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- üìÖ **–ï–∂–µ–¥–Ω–µ–≤–Ω–æ** (–º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å)
- üîÑ **–ü–æ—Å–ª–µ –≤–∞–∂–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π**
- üìä **–ü–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –æ—Ç—á–µ—Ç–æ–≤**

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–ø–∏–π

**Python:**
```powershell
python backup_db.py --keep-days 60
```

**PowerShell:**
```powershell
.\backup_db.ps1 -KeepDays 60
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 30 –¥–Ω–µ–π

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–∫–∏ backups

```
backups/
‚îú‚îÄ‚îÄ bot_database_2025-10-12_15-43-55.db  (–ø–æ—Å–ª–µ–¥–Ω—è—è)
‚îú‚îÄ‚îÄ bot_database_2025-10-12_14-30-00.db
‚îú‚îÄ‚îÄ bot_database_2025-10-11_18-45-22.db
‚îú‚îÄ‚îÄ bot_database_2025-10-10_12-00-00.db
‚îî‚îÄ‚îÄ ...
```

---

## üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏

### –°–ø–æ—Å–æ–± 1: –ó–∞–º–µ–Ω–∞ —Ñ–∞–π–ª–∞

**1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–æ—Ç:**
```powershell
Get-Process python -ErrorAction SilentlyContinue | Stop-Process -Force
```

**2. –°–¥–µ–ª–∞–π—Ç–µ –∫–æ–ø–∏—é —Ç–µ–∫—É—â–µ–π –ë–î (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π):**
```powershell
Copy-Item bot_database.db bot_database_current.db
```

**3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ backup:**
```powershell
Copy-Item backups\bot_database_2025-10-12_15-43-55.db bot_database.db -Force
```

**4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç:**
```powershell
python bot.py
```

### –°–ø–æ—Å–æ–± 2: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ

```powershell
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–æ—Ç
Get-Process python -ErrorAction SilentlyContinue | Stop-Process -Force

# –ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ —Ç–µ–∫—É—â—É—é –ë–î
Rename-Item bot_database.db bot_database_old.db

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ backup
Copy-Item backups\bot_database_2025-10-12_15-43-55.db bot_database.db

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç
python bot.py
```

---

## ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è

### Windows Task Scheduler (–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞–Ω–∏–π)

**1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `scheduled_backup.bat`:**
```batch
@echo off
cd C:\Bot_test\telegram_repair_bot
python backup_db.py
```

**2. –û—Ç–∫—Ä–æ–π—Ç–µ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞–Ω–∏–π:**
```powershell
taskschd.msc
```

**3. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞–Ω–∏–µ:**
- –ò–º—è: "Bot Database Backup"
- –¢—Ä–∏–≥–≥–µ—Ä: –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 3:00 AM
- –î–µ–π—Å—Ç–≤–∏–µ: –ó–∞–ø—É—Å–∫ `scheduled_backup.bat`

### Cron (Linux)

```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å crontab
crontab -e

# –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É (backup –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00)
0 3 * * * cd /path/to/bot && python backup_db.py
```

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∫–æ–ø–∏–∏:

**PowerShell:**
```powershell
Get-ChildItem backups | Format-Table Name, Length, LastWriteTime
```

**Python:**
```powershell
python -c "import os; print('\n'.join(sorted(os.listdir('backups'), reverse=True)))"
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –ø–∞–ø–∫–∏:

```powershell
$size = (Get-ChildItem backups -Recurse | Measure-Object -Property Length -Sum).Sum
Write-Host "–†–∞–∑–º–µ—Ä –ø–∞–ø–∫–∏ backups: $([math]::Round($size/1MB, 2)) MB"
```

---

## üóÇÔ∏è –≠–∫—Å–ø–æ—Ä—Ç –≤ –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã

### SQL –¥–∞–º–ø (–¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏)

```powershell
sqlite3 bot_database.db .dump > database_dump.sql
```

### CSV —ç–∫—Å–ø–æ—Ä—Ç —Ç–∞–±–ª–∏—Ü—ã:

```powershell
sqlite3 bot_database.db
.mode csv
.output users_export.csv
SELECT * FROM users;
.quit
```

### JSON —ç–∫—Å–ø–æ—Ä—Ç (—á–µ—Ä–µ–∑ Python):

```python
import sqlite3
import json

conn = sqlite3.connect('bot_database.db')
conn.row_factory = sqlite3.Row
cursor = conn.cursor()

cursor.execute("SELECT * FROM users")
users = [dict(row) for row in cursor.fetchall()]

with open('users_export.json', 'w', encoding='utf-8') as f:
    json.dump(users, f, indent=2, ensure_ascii=False, default=str)

print("–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω: users_export.json")
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. –†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –¢–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä: ~72 KB
- –ü—Ä–∏ —Ä–æ—Å—Ç–µ –¥–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö MB —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –º–µ—Å—Ç–æ–º –Ω–∞ –¥–∏—Å–∫–µ
- –°—Ç–∞—Ä—ã–µ –∫–æ–ø–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π

### 2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ü–∞–ø–∫–∞ `backups/` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ `.gitignore` (—É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ)
- –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –≤ –ø—É–±–ª–∏—á–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö
- –°–æ–¥–µ—Ä–∂–∏—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 3. –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å
- –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∫–æ–ø–∏–∏ –ø—Ä–∏ **–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–º –±–æ—Ç–µ** (–µ—Å–ª–∏ –≤–∞–∂–Ω–∞ 100% —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å)
- –î–ª—è —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ –±–æ—Ç–∞ –∫–æ–ø–∏–∏ —Ç–æ–∂–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã (SQLite –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —á—Ç–µ–Ω–∏–µ)

### 4. –•—Ä–∞–Ω–µ–Ω–∏–µ
- –•—Ä–∞–Ω–∏—Ç–µ –≤–∞–∂–Ω—ã–µ –∫–æ–ø–∏–∏ –≤–Ω–µ –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (Google Drive, Dropbox)
- –î–µ–ª–∞–π—Ç–µ –∫–æ–ø–∏–∏ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –º–æ–∂–Ω–æ –ª–∏ –æ—Ç–∫—Ä—ã—Ç—å:

```powershell
sqlite3 backups\bot_database_2025-10-12_15-43-55.db "SELECT COUNT(*) FROM users;"
```

–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å —á–∏—Å–ª–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ Python:

```python
import sqlite3

db_file = "backups/bot_database_2025-10-12_15-43-55.db"

try:
    conn = sqlite3.connect(db_file)
    cursor = conn.cursor()

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü
    cursor.execute("SELECT name FROM sqlite_master WHERE type='table'")
    tables = cursor.fetchall()

    print(f"‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ü–µ–ª–∞—è. –ù–∞–π–¥–µ–Ω–æ —Ç–∞–±–ª–∏—Ü: {len(tables)}")
    for table in tables:
        cursor.execute(f"SELECT COUNT(*) FROM {table[0]}")
        count = cursor.fetchone()[0]
        print(f"   {table[0]}: {count} –∑–∞–ø–∏—Å–µ–π")

    conn.close()
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
```

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `DATABASE_USAGE_GUIDE.md` - —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- `HOW_TO_ADD_DISPATCHER_ROLE.md` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏
- `check_database.py` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ë–î

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ë—ã—Å—Ç—Ä–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º:

```powershell
# –ü–µ—Ä–µ–¥ –≤–∞–∂–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
Copy-Item bot_database.db -Destination "bot_database_before_update.db"
```

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö –≤–µ—Ä—Å–∏–π –ë–î:

```powershell
# –†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤
(Get-Item bot_database.db).Length
(Get-Item backups\bot_database_2025-10-12_15-43-55.db).Length
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∫–æ–ø–∏–∏:

```powershell
$latest = Get-ChildItem backups -Filter "bot_database_*.db" | Sort-Object LastWriteTime -Descending | Select-Object -First 1
Copy-Item $latest.FullName bot_database.db -Force
Write-Host "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏–∑: $($latest.Name)"
```

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 12 –æ–∫—Ç—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è:** 1.0

---

## ‚úÖ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

```
üìÅ –ü–∞–ø–∫–∞ backups: –°–æ–∑–¥–∞–Ω–∞
üìä –†–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π: 2
üìè –†–∞–∑–º–µ—Ä –ë–î: 72 KB
üïê –ü–æ—Å–ª–µ–¥–Ω–∏–π backup: 2025-10-12 15:43:55
‚úÖ –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞: –í–∫–ª—é—á–µ–Ω–∞ (30 –¥–Ω–µ–π)
```
