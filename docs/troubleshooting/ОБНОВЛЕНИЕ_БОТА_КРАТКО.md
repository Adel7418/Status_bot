# üîÑ –ë—ã—Å—Ç—Ä–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: –ë–æ—Ç –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–î–∞—Ç–∞:** 15 –æ–∫—Ç—è–±—Ä—è 2025

---

## ‚ö° –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ (90% —Å–ª—É—á–∞–µ–≤)

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh user@–≤–∞—à_IP

# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd ~/telegram_repair_bot

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
bash scripts/update_bot.sh
```

**–ì–æ—Ç–æ–≤–æ!** –°–∫—Ä–∏–ø—Ç –≤—Å—ë —Å–¥–µ–ª–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---

## üîç –ï—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ –ø–æ–º–æ–≥–ª–æ

### –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É

```bash
bash scripts/diagnose_update.sh
```

–°–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∂–µ—Ç –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –¥–∞—Å—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.

---

## üìã –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–ø–æ—à–∞–≥–æ–≤–æ)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh user@–≤–∞—à_IP
cd ~/telegram_repair_bot

# 2. Backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
mkdir -p backups
cp data/bot_database.db backups/backup_$(date +%Y%m%d_%H%M%S).db

# 3. –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker compose -f docker/docker-compose.prod.yml down

# 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
git pull origin main

# 5. –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –ë–ï–ó –∫—ç—à–∞
docker compose -f docker/docker-compose.prod.yml build --no-cache

# 6. –ó–∞–ø—É—Å–∫
docker compose -f docker/docker-compose.prod.yml up -d

# 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker compose -f docker/docker-compose.prod.yml logs -f bot
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è –º–µ–ª–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π)

```bash
cd ~/telegram_repair_bot
git pull origin main
docker compose -f docker/docker-compose.prod.yml restart bot
docker compose -f docker/docker-compose.prod.yml logs -f bot
```

‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ:** –ù–µ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑!

---

## üêõ –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –∫–æ–¥ —Å—Ç–∞—Ä—ã–π"

**–ü—Ä–∏—á–∏–Ω–∞:** Docker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–∑

**–†–µ—à–µ–Ω–∏–µ:**
```bash
cd ~/telegram_repair_bot
docker compose -f docker/docker-compose.prod.yml down
docker compose -f docker/docker-compose.prod.yml build --no-cache
docker compose -f docker/docker-compose.prod.yml up -d
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "git pull –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç"

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```bash
docker compose -f docker/docker-compose.prod.yml build --no-cache
docker compose -f docker/docker-compose.prod.yml up -d --force-recreate
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "Database locked"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
docker compose -f docker/docker-compose.prod.yml down
rm -f data/bot_database.db-journal
rm -f data/bot_database.db-shm
rm -f data/bot_database.db-wal
docker compose -f docker/docker-compose.prod.yml up -d
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: "Permission denied"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
sudo chown -R $USER:$USER ~/telegram_repair_bot/
chmod 755 ~/telegram_repair_bot/data
chmod 600 ~/telegram_repair_bot/.env
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 5: "Systemd —Å–µ—Ä–≤–∏—Å –º–µ—à–∞–µ—Ç"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
sudo systemctl stop telegram-bot
# –¢–µ–ø–µ—Ä—å –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –≤—Ä—É—á–Ω—É—é
sudo systemctl start telegram-bot  # –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```

---

## üÜò –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

### –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å (–ö–†–ê–ô–ù–ò–ô –°–õ–£–ß–ê–ô!)

‚ö†Ô∏è **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –°–î–ï–õ–ê–ô–¢–ï BACKUP –ë–ê–ó–´ –î–ê–ù–ù–´–•!**

```bash
# 1. BACKUP!
cp ~/telegram_repair_bot/data/bot_database.db ~/bot_backup_$(date +%Y%m%d).db

# 2. –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
cd ~/telegram_repair_bot
docker compose -f docker/docker-compose.prod.yml down -v
docker system prune -a --volumes

# 3. –ü–æ–≤—Ç–æ—Ä–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
cd ~
mv telegram_repair_bot telegram_repair_bot_old
git clone https://github.com/Adel7418/Status_bot.git telegram_repair_bot
cd telegram_repair_bot

# 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env
cp env.example .env
nano .env  # –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

# 5. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î
cp ~/bot_backup_*.db data/bot_database.db

# 6. –ó–∞–ø—É—Å–∫
docker compose -f docker/docker-compose.prod.yml build --no-cache
docker compose -f docker/docker-compose.prod.yml up -d
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```bash
# 1. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
docker compose -f docker/docker-compose.prod.yml ps

# 2. –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
docker compose -f docker/docker-compose.prod.yml logs --tail=50 bot | grep -i error

# 3. Healthcheck –≤ –ø–æ—Ä—è–¥–∫–µ
docker inspect telegram_repair_bot_prod | grep -i health

# 4. –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –≤ Telegram
# –û—Ç–ø—Ä–∞–≤—å—Ç–µ /start –±–æ—Ç—É
```

---

## üìä –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker compose -f docker/docker-compose.prod.yml logs -f bot

# –°—Ç–∞—Ç—É—Å
docker compose -f docker/docker-compose.prod.yml ps

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker compose -f docker/docker-compose.prod.yml restart bot

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker compose -f docker/docker-compose.prod.yml down

# –ó–∞–ø—É—Å–∫
docker compose -f docker/docker-compose.prod.yml up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats telegram_repair_bot_prod --no-stream

# –ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç
git log -1 --oneline

# –†–∞–∑–Ω–∏—Ü–∞ —Å origin
git fetch origin main
git log HEAD..origin/main --oneline
```

---

## üîó –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- **–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ:** [docs/troubleshooting/BOT_UPDATE_ISSUES.md](BOT_UPDATE_ISSUES.md)
- **–î–µ–ø–ª–æ–π:** [docs/deployment/DEPLOY_VPS_LINUX_GUIDE.md](../deployment/DEPLOY_VPS_LINUX_GUIDE.md)
- **–ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã:** [docs/deployment/QUICK_DEPLOY_COMMANDS.md](../deployment/QUICK_DEPLOY_COMMANDS.md)

---

## üìû –ê–ª–≥–æ—Ä–∏—Ç–º –¥–µ–π—Å—Ç–≤–∏–π

1. **–°–Ω–∞—á–∞–ª–∞:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ `bash scripts/update_bot.sh`
2. **–ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ `bash scripts/diagnose_update.sh`
3. **–°–ª–µ–¥—É–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º** –∏–∑ –≤—ã–≤–æ–¥–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
4. **–ï—Å–ª–∏ –≤—Å—ë —Å–ª–æ–∂–Ω–æ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–Ω–æ–µ —Ä—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–í–∞—Ä–∏–∞–Ω—Ç 1)
5. **–ö—Ä–∞–π–Ω–∏–π —Å–ª—É—á–∞–π:** –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å (—Å–º. –≤—ã—à–µ)

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

1. **–í–°–ï–ì–î–ê** –¥–µ–ª–∞–π—Ç–µ backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
2. **–í–°–ï–ì–î–ê** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--no-cache` –ø—Ä–∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ –æ–±—Ä–∞–∑–∞
3. **–ù–ï –ó–ê–ë–´–í–ê–ô–¢–ï** –¥–µ–ª–∞—Ç—å `git pull` –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π
4. **–ü–†–û–í–ï–†–Ø–ô–¢–ï** –ª–æ–≥–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
5. **–¢–ï–°–¢–ò–†–£–ô–¢–ï** –±–æ—Ç–∞ –≤ Telegram –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 15 –æ–∫—Ç—è–±—Ä—è 2025

üí° **–°–æ–≤–µ—Ç:** –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç—É –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –≤ –∑–∞–∫–ª–∞–¥–∫–∏!

