# üë®‚Äçüíº –ê–¥–º–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç –∏–º–µ–Ω–∏ –º–∞—Å—Ç–µ—Ä–∞

## –û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

–ê–¥–º–∏–Ω–∏—Å—Ç –∏–Ω—Ç–æ—Ä –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∑–∞—è–≤–∫–∞–º–∏ –æ—Ç –∏–º–µ–Ω–∏ –º–∞—Å—Ç–µ—Ä–∞ –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:
1. **–í —Ä–∞–±–æ—á–µ–π –≥—Ä—É–ø–ø–µ –º–∞—Å—Ç–µ—Ä–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞ –ø–æ –≥—Ä—É–ø–ø–µ
2. **–ß–µ—Ä–µ–∑ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç** - —Ä—É—á–Ω–æ–π –≤—ã–±–æ—Ä –¥–µ–π—Å—Ç–≤–∏–π "–∑–∞ –º–∞—Å—Ç–µ—Ä–∞"

## –†–∞–±–æ—Ç–∞ –≤ —Ä–∞–±–æ—á–µ–π –≥—Ä—É–ø–ø–µ –º–∞—Å—Ç–µ—Ä–∞

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ö–æ–≥–¥–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–±–æ—á–µ–π –≥—Ä—É–ø–ø–µ –º–∞—Å—Ç–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –≥—Ä—É–ø–ø–µ –º–∞—Å—Ç–µ—Ä–∞ "–î–∏—Å–ø"), –æ–Ω –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ã—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –º–∞—Å—Ç–µ—Ä–∞:
- ‚úÖ –ü—Ä–∏–Ω—è—Ç—å –∑–∞—è–≤–∫—É
- üè† –Ø –Ω–∞ –æ–±—ä–µ–∫—Ç–µ
- üí∞ –ó–∞–≤–µ—Ä—à–∏—Ç—å
- ‚è≥ –î–ª–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–º–æ–Ω—Ç

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –°–∏—Å—Ç–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (–ø–æ —Ä–æ–ª–∏)
2. –ù–∞—Ö–æ–¥–∏—Ç –º–∞—Å—Ç–µ—Ä–∞ –ø–æ `work_chat_id` —Ä–∞–±–æ—á–µ–π –≥—Ä—É–ø–ø—ã
3. –í—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ –æ—Ç –∏–º–µ–Ω–∏ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞
4. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∏—Å–ª—è—Ç—Å—è –∑–∞ –º–∞—Å—Ç–µ—Ä–æ–º —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```
–ê–¥–º–∏–Ω –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –≥—Ä—É–ø–ø–µ –º–∞—Å—Ç–µ—Ä–∞ "–î–∏—Å–ø"
‚Üì
–í–∏–¥–∏—Ç –∑–∞—è–≤–∫—É #123 —Å –∫–Ω–æ–ø–∫–æ–π "‚úÖ –ü—Ä–∏–Ω—è—Ç—å –∑–∞—è–≤–∫—É"
‚Üì
–ù–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É
‚Üì
–°–∏—Å—Ç–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –∞–¥–º–∏–Ω, –≥—Ä—É–ø–ø–∞ = group_123
‚Üì
–ù–∞—Ö–æ–¥–∏—Ç –º–∞—Å—Ç–µ—Ä–∞ —Å work_chat_id = group_123 (—ç—Ç–æ –º–∞—Å—Ç–µ—Ä "–î–∏—Å–ø")
‚Üì
–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞—è–≤–∫—É –æ—Ç –∏–º–µ–Ω–∏ –º–∞—Å—Ç–µ—Ä–∞ "–î–∏—Å–ø"
‚Üì
–£–≤–µ–¥–æ–º–ª—è–µ—Ç –º–∞—Å—Ç–µ—Ä–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
```

## –†–∞–±–æ—Ç–∞ —á–µ—Ä–µ–∑ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∞

–ü—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –∑–∞—è–≤–∫–∏ —Å –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º –º–∞—Å—Ç–µ—Ä–æ–º, –∞–¥–º–∏–Ω –≤–∏–¥–∏—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏:
- ‚úÖ –ü—Ä–∏–Ω—è—Ç—å (–∑–∞ –º–∞—Å—Ç–µ—Ä–∞)
- üè† –ù–∞ –æ–±—ä–µ–∫—Ç–µ (–∑–∞ –º–∞—Å—Ç–µ—Ä–∞)
- üí∞ –ó–∞–≤–µ—Ä—à–∏—Ç—å (–∑–∞ –º–∞—Å—Ç–µ—Ä–∞)
- ‚è≥ DR (–∑–∞ –º–∞—Å—Ç–µ—Ä–∞)

–≠—Ç–∏ –∫–Ω–æ–ø–∫–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–æ–ª–∏ ADMIN –∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:
- –ó–∞—è–≤–∫–∞ –∏–º–µ–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞ (`assigned_master_id`)
- –°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–Ω–æ–ø–∫–µ

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

#### 1. –ì—Ä—É–ø–ø–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (`app/handlers/group_interaction.py`)

–í—Å–µ –≥—Ä—É–ø–ø–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç–µ–ø–µ—Ä—å:
- –ü—Ä–∏–Ω–∏–º–∞—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `user_roles: list`
- –ü—Ä–æ–≤–µ—Ä—è—é—Ç –Ω–∞–ª–∏—á–∏–µ —Ä–æ–ª–∏ `UserRole.ADMIN`
- –ï—Å–ª–∏ –∞–¥–º–∏–Ω - –Ω–∞—Ö–æ–¥—è—Ç –º–∞—Å—Ç–µ—Ä–∞ –ø–æ `work_chat_id` –≥—Ä—É–ø–ø—ã
- –ï—Å–ª–∏ –º–∞—Å—Ç–µ—Ä - —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –æ–±—ã—á–Ω–æ

```python
if UserRole.ADMIN in user_roles:
    master = await db.get_master_by_work_chat_id(callback.message.chat.id)
    is_admin_acting = True
else:
    master = await db.get_master_by_telegram_id(callback.from_user.id)
    is_admin_acting = False
```

#### 2. –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∞–¥–º–∏–Ω–∞ (`app/handlers/admin.py`)

–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
- `callback_admin_accept_order` - –ø—Ä–∏–Ω—è—Ç–∏–µ –∑–∞—è–≤–∫–∏ –∑–∞ –º–∞—Å—Ç–µ—Ä–∞
- `callback_admin_onsite_order` - –æ—Ç–º–µ—Ç–∫–∞ "–Ω–∞ –æ–±—ä–µ–∫—Ç–µ" –∑–∞ –º–∞—Å—Ç–µ—Ä–∞
- `callback_admin_complete_order` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞ –º–∞—Å—Ç–µ—Ä–∞
- `callback_admin_dr_order` - –¥–ª–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–º–æ–Ω—Ç –∑–∞ –º–∞—Å—Ç–µ—Ä–∞

#### 3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (`app/database/db.py`)

–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥:
```python
async def get_master_by_work_chat_id(self, work_chat_id: int) -> Master | None:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞ –ø–æ ID —Ä–∞–±–æ—á–µ–π –≥—Ä—É–ø–ø—ã"""
```

#### 4. –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ (`app/keyboards/inline.py`)

–§—É–Ω–∫—Ü–∏—è `get_order_actions_keyboard` —Ä–∞—Å—à–∏—Ä–µ–Ω–∞ –¥–ª—è –∞–¥–º–∏–Ω–∞:
```python
if user_role == UserRole.ADMIN and order.assigned_master_id:
    # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –º–∞—Å—Ç–µ—Ä–∞
    if order.status == OrderStatus.ASSIGNED:
        builder.row(InlineKeyboardButton(
            text="‚úÖ –ü—Ä–∏–Ω—è—Ç—å (–∑–∞ –º–∞—Å—Ç–µ—Ä–∞)",
            callback_data=f"admin_accept_order:{order.id}"
        ))
    # ... –∏ —Ç.–¥.
```

### FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è

–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ –æ—Ç –∏–º–µ–Ω–∏ –º–∞—Å—Ç–µ—Ä–∞ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è:
```python
await state.update_data(acting_as_master_id=master.telegram_id)
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –∏ DR –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —á—Ç–æ –¥–µ–π—Å—Ç–≤—É–µ—Ç –∞–¥–º–∏–Ω –æ—Ç –∏–º–µ–Ω–∏ –º–∞—Å—Ç–µ—Ä–∞.

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∞ –æ—Ç –∏–º–µ–Ω–∏ –º–∞—Å—Ç–µ—Ä–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
- –í audit_log —Å —É–∫–∞–∑–∞–Ω–∏–µ–º telegram_id –∞–¥–º–∏–Ω–∞
- –í –ª–æ–≥–∞—Ö —Å —É—Ä–æ–≤–Ω–µ–º INFO
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –º–∞—Å—Ç–µ—Ä—É –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É

### –ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤

```
INFO: Admin 123456 acting as master 789012 in group -987654321
INFO: Admin 123456 accepting order as master 789012
INFO: Admin 123456 completing order as master 789012
```

## –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ú–∞—Å—Ç–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
```
‚úÖ –ó–∞—è–≤–∫–∞ #123 –ø—Ä–∏–Ω—è—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –æ—Ç –≤–∞—à–µ–≥–æ –∏–º–µ–Ω–∏!

üîß –î–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏:
üì± –¢–∏–ø —Ç–µ—Ö–Ω–∏–∫–∏: –•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫
üìù –û–ø–∏—Å–∞–Ω–∏–µ: –ù–µ –º–æ—Ä–æ–∑–∏—Ç
üë§ –ö–ª–∏–µ–Ω—Ç: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
üìç –ê–¥—Ä–µ—Å: —É–ª. –õ–µ–Ω–∏–Ω–∞, 1
```

### –î–∏—Å–ø–µ—Ç—á–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –æ–±—ã—á–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
```
‚úÖ –ú–∞—Å—Ç–µ—Ä –î–∏—Å–ø –ø—Ä–∏–Ω—è–ª –∑–∞—è–≤–∫—É #123
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. –¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—å—é `UserRole.ADMIN` –º–æ–≥—É—Ç –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –æ—Ç –∏–º–µ–Ω–∏ –º–∞—Å—Ç–µ—Ä–∞
2. –í –≥—Ä—É–ø–ø–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ `work_chat_id` —É –º–∞—Å—Ç–µ—Ä–∞
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∑–∞—è–≤–∫–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–º—É –º–∞—Å—Ç–µ—Ä—É
4. –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚úÖ –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å –º–∞—Å—Ç–µ—Ä—É —Å –∑–∞—è–≤–∫–∞–º–∏
- ‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —á–∏—Å–ª—è—Ç—Å—è –∑–∞ –º–∞—Å—Ç–µ—Ä–æ–º
- ‚úÖ –£–¥–æ–±–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–∞—Ö
- ‚úÖ –ü—Ä–æ–∑—Ä–∞—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –ø—Ä–æ—Ü–µ—Å—Å–∞

