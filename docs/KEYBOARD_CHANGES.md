# 📱 Изменения в клавиатуре фильтров заявок

## 🔄 Что изменилось

### ❌ **БЫЛО:**

```
┌──────────────────────────┬──────────────────────────┐
│   🆕 Новые (5)           │  👨‍🔧 Назначенные (3)      │
├──────────────────────────┼──────────────────────────┤
│   ✅ Принятые (2)        │  🏠 На объекте (1)       │
├──────────────────────────┼──────────────────────────┤
│   💰 Завершенные (120)   │  ⏳ Длительный ремонт... │
└──────────────────────────┴──────────────────────────┘
```

**Проблемы:**
- ❌ Счётчик завершённых заказов занимает место (может быть очень большим)
- ❌ Кнопка "Длительные ремонты" обрезается на мобильных устройствах
- ❌ Завершённые заявки доступны через отчёты, кнопка избыточна

### ✅ **СТАЛО:**

```
┌──────────────────────────┬──────────────────────────┐
│   🆕 Новые (5)           │  👨‍🔧 Назначенные (3)      │
├──────────────────────────┼──────────────────────────┤
│   ✅ Принятые (2)        │  🏠 На объекте (1)       │
├──────────────────────────┴──────────────────────────┤
│        ⏳ Длительные ремонты (4)                     │
└───────────────────────────────────────────────────────┘
```

**Улучшения:**
- ✅ Убрана кнопка "Завершенные" - данные в отчётах
- ✅ "Длительные ремонты" на всю ширину - лучше видно на мобильных
- ✅ Счётчик всегда виден для "Длительных ремонтов"
- ✅ Клавиатура компактнее и удобнее

## 📝 Технические изменения

### `app/keyboards/inline.py`

**Изменение 1:** Убрана переменная `closed_text`
```python
# УДАЛЕНО:
# closed_text = f"💰 Завершенные ({counts.get(OrderStatus.CLOSED, 0)})"

# ДОБАВЛЕНО:
# Длительные ремонты - всегда показываем счётчик для видимости
dr_text = f"⏳ Длительные ремонты ({counts.get(OrderStatus.DR, 0)})"
```

**Изменение 2:** Убрана кнопка "Завершенные", "Длительные ремонты" на отдельной строке
```python
# УДАЛЕНО:
# builder.row(
#     InlineKeyboardButton(text=closed_text, ...),
#     InlineKeyboardButton(text=dr_text, ...),
# )

# ДОБАВЛЕНО:
# Длительные ремонты - отдельная широкая строка для лучшей видимости
builder.row(
    InlineKeyboardButton(
        text=dr_text,
        callback_data=create_callback_data("filter_orders", OrderStatus.DR),
    ),
)
```

### `app/handlers/dispatcher.py`

**Изменение:** Убран подсчёт CLOSED заказов (2 места)

```python
# БЫЛО:
for status in [OrderStatus.NEW, OrderStatus.ASSIGNED, OrderStatus.ACCEPTED,
              OrderStatus.ONSITE, OrderStatus.CLOSED, OrderStatus.DR]:

# СТАЛО:
for status in [OrderStatus.NEW, OrderStatus.ASSIGNED, OrderStatus.ACCEPTED,
              OrderStatus.ONSITE, OrderStatus.DR]:
```

Изменено в функциях:
- `btn_all_orders()` - кнопка "📋 Все заявки"
- `callback_back_to_orders()` - возврат к списку заявок

## 🎯 Где посмотреть завершённые заявки

Завершённые заявки теперь доступны через:

### 1. Финансовые отчёты
```
📊 Отчеты → 📅 Ежедневный отчет
📊 Отчеты → 📆 Еженедельный отчет
📊 Отчеты → 🗓️ Ежемесячный отчет
```

В отчётах можно:
- Просмотреть все завершённые заказы за период
- Увидеть финансовую статистику
- Экспортировать в Excel
- Отфильтровать по мастерам

### 2. База данных
Все завершённые заявки сохраняются в:
- Таблица `orders` со статусом `CLOSED`
- Таблица `order_reports` - детальная информация для отчётов

### 3. Скрипты
```bash
python scripts/view_order_reports.py
```

## 📊 Преимущества изменений

1. ✅ **Лучшая видимость на мобильных** - "Длительные ремонты" не обрезается
2. ✅ **Меньше нагрузки на БД** - не подсчитываем CLOSED при каждом открытии
3. ✅ **Чище интерфейс** - убрана редко используемая кнопка
4. ✅ **Логичнее** - завершённые заявки в отчётах, активные в фильтрах

## 🔍 Пример использования

**До изменений:**
1. Пользователь нажимает "📋 Все заявки"
2. Видит 6 кнопок фильтров
3. "Длительный ремонт (4)" обрезается → "Длительный ремо..."
4. "Завершенные (120)" занимает много места

**После изменений:**
1. Пользователь нажимает "📋 Все заявки"
2. Видит 5 кнопок фильтров (актуальные статусы)
3. "⏳ Длительные ремонты (4)" - полностью видно, широкая кнопка
4. Для завершённых → идёт в "📊 Отчеты"

---

**Дата изменения:** 2025-10-16
**Версия:** 2.0
