# üìä –°–∏—Å—Ç–µ–º–∞ –æ—Ç—á–µ—Ç–æ–≤ - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

**–í–µ—Ä—Å–∏—è:** 3.0
**–î–∞—Ç–∞:** 20.10.2025
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–¢–∏–ø—ã –æ—Ç—á–µ—Ç–æ–≤](#—Ç–∏–ø—ã-–æ—Ç—á–µ—Ç–æ–≤)
3. [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
4. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ñ–∞–π–ª–æ–≤)
5. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏](#—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ-–¥–µ—Ç–∞–ª–∏)

---

## üéØ –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Excel –æ—Ç—á–µ—Ç—ã —Å –ø–æ–ª–Ω–æ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ –∑–∞—è–≤–∫–∞–º, –º–∞—Å—Ç–µ—Ä–∞–º –∏ —Ñ–∏–Ω–∞–Ω—Å–∞–º.

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –§–∞–π–ª—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è (–Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ)
- ‚úÖ –ú–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã
- ‚úÖ –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- ‚úÖ –í—ã–±–æ—Ä –º–∞—Å—Ç–µ—Ä–∞ –∏–∑ —Å–ø–∏—Å–∫–∞

---

## üìä –¢–∏–ø—ã –æ—Ç—á–µ—Ç–æ–≤

### 1. –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã (—á–µ—Ä–µ–∑ –º–µ–Ω—é)

–î–æ—Å—Ç—É–ø: **üìä –û—Ç—á–µ—Ç—ã** ‚Üí –í—ã–±–æ—Ä —Ç–∏–ø–∞

| –û—Ç—á–µ—Ç | –§–∞–π–ª | –õ–∏—Å—Ç–æ–≤ | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ |
|-------|------|--------|------------|
| üìÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π | `financial_report_daily.xlsx` | 2 | –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ |
| üìÜ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π | `financial_report_weekly.xlsx` | 2 | –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ |
| üóìÔ∏è –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π | `financial_report_monthly.xlsx` | 2 | –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ |

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
- **–õ–∏—Å—Ç 1:** –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ + —Å–≤–æ–¥–∫–∞ –ø–æ –º–∞—Å—Ç–µ—Ä–∞–º)
- **–õ–∏—Å—Ç 2:** –ó–∞—è–≤–∫–∏ –ø–æ –º–∞—Å—Ç–µ—Ä–∞–º (–¥–µ—Ç–∞–ª–∏ –∫–∞–∂–¥–æ–π –∑–∞—è–≤–∫–∏)

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã (–ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é)

| –û—Ç—á–µ—Ç | –§–∞–π–ª | –õ–∏—Å—Ç–æ–≤ | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|--------|------------|
| –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π | `report_daily.xlsx` | 4 | –ö–∞–∂–¥—ã–π –¥–µ–Ω—å 8:00 |
| –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π | `report_weekly.xlsx` | 4 | –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ 9:00 |
| –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π | `report_monthly.xlsx` | 4 | 1-–≥–æ —á–∏—Å–ª–∞ 10:00 |

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
- **–õ–∏—Å—Ç 1:** –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–æ–±—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏)
- **–õ–∏—Å—Ç 2:** –ó–∞–∫–∞–∑—ã (–∑–∞–∫—Ä—ã—Ç—ã–µ –∑–∞—è–≤–∫–∏)
- **–õ–∏—Å—Ç 3:** –ú–∞—Å—Ç–µ—Ä–∞ (—Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å–≤–æ–¥–∫–∞)
- **–õ–∏—Å—Ç 4:** –ó–∞—è–≤–∫–∏ –ø–æ –º–∞—Å—Ç–µ—Ä–∞–º (–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è)

### 3. –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã

| –û—Ç—á–µ—Ç | –ö–Ω–æ–ø–∫–∞ | –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|--------|------|----------|
| –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞–∫–∞–∑—ã | ‚úÖ –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞–∫–∞–∑—ã | `closed_orders.xlsx` | –ó–∞ 30 –¥–Ω–µ–π |
| –ü–æ –º–∞—Å—Ç–µ—Ä—É | üë®‚Äçüîß –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Å—Ç–µ—Ä–æ–≤ | `master_{id}_{name}.xlsx` | –í—Å–µ –∑–∞—è–≤–∫–∏ –º–∞—Å—Ç–µ—Ä–∞ |

**–ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞–∫–∞–∑—ã:**
- ID, —Ç–µ—Ö–Ω–∏–∫–∞, –∫–ª–∏–µ–Ω—Ç, –º–∞—Å—Ç–µ—Ä
- –î–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∑–∞–∫—Ä—ã—Ç–∏—è
- –°—É–º–º—ã, –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –ø—Ä–∏–±—ã–ª—å
- –î–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–≤—ã–µ–∑–¥, –æ—Ç–∑—ã–≤)
- –ò—Ç–æ–≥–æ–≤—ã–µ —Å—É–º–º—ã

**–ü–æ –º–∞—Å—Ç–µ—Ä—É:**
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Å—Ç–µ—Ä–∞ (–≤—Å–µ–≥–æ, –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –≤ —Ä–∞–±–æ—Ç–µ)
- –í—Å–µ –∑–∞—è–≤–∫–∏ (–∞–∫—Ç–∏–≤–Ω—ã–µ + –∑–∞–∫—Ä—ã—Ç—ã–µ)
- –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤
- –ò—Ç–æ–≥–∏ –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–º

---

## üíº –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã

```
1. –í –±–æ—Ç–µ –Ω–∞–∂–º–∏—Ç–µ: üìä –û—Ç—á–µ—Ç—ã
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø: üìÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π / üìÜ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π / üóìÔ∏è –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π
3. –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥
4. –ù–∞–∂–º–∏—Ç–µ: üíæ –°–∫–∞—á–∞—Ç—å Excel
5. –ü–æ–ª—É—á–∏—Ç–µ —Ñ–∞–π–ª —Å 2 –ª–∏—Å—Ç–∞–º–∏
```

### –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞–∫–∞–∑—ã

```
1. –í –±–æ—Ç–µ –Ω–∞–∂–º–∏—Ç–µ: üìä –û—Ç—á–µ—Ç—ã
2. –ù–∞–∂–º–∏—Ç–µ: ‚úÖ –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞–∫–∞–∑—ã (Excel)
3. –ü–æ–ª—É—á–∏—Ç–µ —Ñ–∞–π–ª closed_orders.xlsx
```

### –û—Ç—á–µ—Ç –ø–æ –º–∞—Å—Ç–µ—Ä—É

```
1. –í –±–æ—Ç–µ –Ω–∞–∂–º–∏—Ç–µ: üìä –û—Ç—á–µ—Ç—ã
2. –ù–∞–∂–º–∏—Ç–µ: üë®‚Äçüîß –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Å—Ç–µ—Ä–æ–≤ (Excel)
3. –í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Å—Ç–µ—Ä–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
4. –ü–æ–ª—É—á–∏—Ç–µ —Ñ–∞–π–ª master_{id}_{name}.xlsx
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã

–û—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Å–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞–º:
- **8:00** - –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç
- **–ü–Ω 9:00** - –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
- **1-–≥–æ 10:00** - –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –æ—Ç—á–µ—Ç

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### –ü–∞–ø–∫–∞ reports/

```
reports/
  ‚îú‚îÄ financial_report_daily.xlsx       (2 –ª–∏—Å—Ç–∞, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
  ‚îú‚îÄ financial_report_weekly.xlsx      (2 –ª–∏—Å—Ç–∞, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
  ‚îú‚îÄ financial_report_monthly.xlsx     (2 –ª–∏—Å—Ç–∞, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
  ‚îú‚îÄ report_daily.xlsx                 (4 –ª–∏—Å—Ç–∞, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
  ‚îú‚îÄ report_weekly.xlsx                (4 –ª–∏—Å—Ç–∞, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
  ‚îú‚îÄ report_monthly.xlsx               (4 –ª–∏—Å—Ç–∞, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
  ‚îú‚îÄ closed_orders.xlsx                (1 –ª–∏—Å—Ç, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
  ‚îú‚îÄ master_1_–ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä.xlsx        (1 –ª–∏—Å—Ç, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
  ‚îú‚îÄ master_2_–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω.xlsx        (1 –ª–∏—Å—Ç, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
  ‚îî‚îÄ master_3_–°–∏–¥–æ—Ä–æ–≤ –ò–≥–æ—Ä—å.xlsx      (1 –ª–∏—Å—Ç, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ß–∏—Å—Ç–∞—è –ø–∞–ø–∫–∞ (~10 —Ñ–∞–π–ª–æ–≤ –≤–º–µ—Å—Ç–æ 100+)
- ‚úÖ –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–º–µ–Ω–∞ (–ª–µ–≥–∫–æ –Ω–∞–π—Ç–∏)
- ‚úÖ –§–∞–π–ª—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è (–Ω–µ –∫–æ–ø—è—Ç—Å—è –¥—É–±–ª–∏–∫–∞—Ç—ã)
- ‚úÖ –í—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## üé® –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤

| –°—Ç–∞—Ç—É—Å | –¶–≤–µ—Ç | Emoji |
|--------|------|-------|
| IN_PROGRESS | üü® –ñ–µ–ª—Ç—ã–π | ‚öôÔ∏è |
| CLOSED | üü© –ó–µ–ª–µ–Ω—ã–π | üîí |
| REFUSED | üü• –ö—Ä–∞—Å–Ω—ã–π | ‚ùå |
| ACCEPTED | –ë–µ–ª—ã–π | ‚úÖ |
| ASSIGNED | –ë–µ–ª—ã–π | üìã |

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É–º–º

- –î–µ–Ω–µ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: `#,##0.00 ‚ÇΩ`
- –¢—ã—Å—è—á–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø—Ä–æ–±–µ–ª–∞–º–∏
- –î–≤–µ –¥–µ—Å—è—Ç–∏—á–Ω—ã–µ —Ü–∏—Ñ—Ä—ã

### –°—Ç–∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

- –ì–ª–∞–≤–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫: —Å–∏–Ω–∏–π —Ñ–æ–Ω, –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç, 14pt
- –ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏: —Å–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω, —á–µ—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç, 12pt
- –ò—Ç–æ–≥–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏: –∂–µ–ª—Ç—ã–π —Ñ–æ–Ω, –∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–∞–π–ª—ã –∫–æ–¥–∞

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏:**

1. **`app/services/excel_export.py`**
   - `export_report_to_excel()` - —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã
   - `export_closed_orders_to_excel()` - –∑–∞–∫—Ä—ã—Ç—ã–µ –∑–∞–∫–∞–∑—ã
   - `export_masters_statistics_to_excel()` - —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –º–µ—Ç–æ–¥
   - `export_master_orders_to_excel()` - –æ—Ç—á–µ—Ç –ø–æ –º–∞—Å—Ç–µ—Ä—É
   - `_add_orders_by_master_sheet()` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–∏—Å—Ç–∞ —Å –∑–∞—è–≤–∫–∞–º–∏

2. **`app/services/reports_service.py`**
   - `generate_daily_report()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
   - `generate_weekly_report()` - –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π
   - `generate_monthly_report()` - –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π
   - `save_report_to_excel()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Excel

3. **`app/handlers/financial_reports.py`**
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –º–µ–Ω—é
   - Callback –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–∞—Å—Ç–µ—Ä–∞
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

4. **`app/services/reports_notifier.py`**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –æ—Ç—á–µ—Ç–æ–≤
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞–º

### –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏

- **openpyxl** - —Å–æ–∑–¥–∞–Ω–∏–µ Excel —Ñ–∞–π–ª–æ–≤
- **aiosqlite** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã
- **aiogram** - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ Telegram

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü—ã:**

- `orders` - –∑–∞—è–≤–∫–∏
- `masters` - –º–∞—Å—Ç–µ—Ä–∞
- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `financial_reports` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç–æ–≤
- `master_financial_reports` - –¥–∞–Ω–Ω—ã–µ –ø–æ –º–∞—Å—Ç–µ—Ä–∞–º

**–û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:**

```sql
-- –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞–∫–∞–∑—ã
SELECT o.*, u.first_name || ' ' || COALESCE(u.last_name, '') as master_name
FROM orders o
LEFT JOIN masters m ON o.assigned_master_id = m.id
LEFT JOIN users u ON m.telegram_id = u.telegram_id
WHERE o.status = 'CLOSED' AND o.deleted_at IS NULL

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Å—Ç–µ—Ä–∞
SELECT
    COUNT(*) as total_orders,
    SUM(CASE WHEN status = 'CLOSED' THEN 1 ELSE 0 END) as closed,
    SUM(CASE WHEN status = 'CLOSED' THEN total_amount ELSE 0 END) as total_sum
FROM orders
WHERE assigned_master_id = ? AND deleted_at IS NULL
```

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç - –õ–∏—Å—Ç 1

```
–§–ò–ù–ê–ù–°–û–í–´–ô –û–¢–ß–ï–¢ - DAILY
–ü–µ—Ä–∏–æ–¥: 20.10.2025

–û–ë–©–ò–ï –ü–û–ö–ê–ó–ê–¢–ï–õ–ò
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å         ‚îÇ –ó–Ω–∞—á–µ–Ω–∏–µ     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤      ‚îÇ 15           ‚îÇ
‚îÇ –û–±—â–∞—è —Å—É–º–º–∞        ‚îÇ 150,000.00 ‚ÇΩ ‚îÇ
‚îÇ –†–∞—Å—Ö–æ–¥–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª ‚îÇ 30,000.00 ‚ÇΩ  ‚îÇ
‚îÇ –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å     ‚îÇ 120,000.00 ‚ÇΩ ‚îÇ
‚îÇ –ü—Ä–∏–±—ã–ª—å –∫–æ–º–ø–∞–Ω–∏–∏   ‚îÇ 40,000.00 ‚ÇΩ  ‚îÇ
‚îÇ –ü—Ä–∏–±—ã–ª—å –º–∞—Å—Ç–µ—Ä–æ–≤   ‚îÇ 80,000.00 ‚ÇΩ  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–û–¢–ß–Å–¢ –ü–û –ú–ê–°–¢–ï–†–ê–ú
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ú–∞—Å—Ç–µ—Ä       ‚îÇ –ó–∞–∫–∞–∑–æ–≤‚îÇ –°—É–º–º–∞      ‚îÇ –ö —Å–¥–∞—á–µ  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –ü–µ—Ç—Ä–æ–≤ –ü.–ü.  ‚îÇ 8      ‚îÇ 80,000 ‚ÇΩ   ‚îÇ 20,000 ‚ÇΩ ‚îÇ
‚îÇ –ò–≤–∞–Ω–æ–≤ –ò.–ò.  ‚îÇ 5      ‚îÇ 50,000 ‚ÇΩ   ‚îÇ 15,000 ‚ÇΩ ‚îÇ
‚îÇ –°–∏–¥–æ—Ä–æ–≤ –°.–°. ‚îÇ 2      ‚îÇ 20,000 ‚ÇΩ   ‚îÇ 5,000 ‚ÇΩ  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ó–∞—è–≤–∫–∏ –ø–æ –º–∞—Å—Ç–µ—Ä–∞–º - –õ–∏—Å—Ç 2

```
–î–ï–¢–ê–õ–ò–ó–ê–¶–ò–Ø –ó–ê–Ø–í–û–ö –ü–û –ú–ê–°–¢–ï–†–ê–ú

üë®‚Äçüîß –ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ID ‚îÇ –°—Ç–∞—Ç—É—Å   ‚îÇ –¢–µ—Ö–Ω–∏–∫–∞  ‚îÇ –ö–ª–∏–µ–Ω—Ç  ‚îÇ –°—É–º–º–∞   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 15 ‚îÇ ‚öôÔ∏è WORK  ‚îÇ –•–æ–ª–æ–¥–∏–ª—å.‚îÇ –ò–≤–∞–Ω–æ–≤  ‚îÇ 0 ‚ÇΩ     ‚îÇ
‚îÇ 22 ‚îÇ üîí CLOSED‚îÇ –ü–ª–∏—Ç–∞    ‚îÇ –°–∏–¥–æ—Ä–æ–≤ ‚îÇ 6,000 ‚ÇΩ ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
–ò—Ç–æ–≥–æ: 6,000.00 ‚ÇΩ

üë®‚Äçüîß –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 12 ‚îÇ ‚öôÔ∏è WORK  ‚îÇ –•–æ–ª–æ–¥–∏–ª—å.‚îÇ –°–º–∏—Ä–Ω–æ–≤ ‚îÇ 0 ‚ÇΩ     ‚îÇ
‚îÇ 25 ‚îÇ üîí CLOSED‚îÇ –î—É—Ö–æ–≤–∫–∞  ‚îÇ –ù–æ–≤–∏–∫–æ–≤ ‚îÇ 4,000 ‚ÇΩ ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
–ò—Ç–æ–≥–æ: 4,000.00 ‚ÇΩ
```

---

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –æ—Ç—á–µ—Ç–∞:

1. –°–æ–±–∏—Ä–∞—é—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
2. –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π Excel workbook
3. –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –≤—Å–µ –ª–∏—Å—Ç—ã
4. –§–∞–π–ª **–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è** —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º
5. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –±–µ–∑ —Å—Ç–∞—Ä—ã—Ö –∫–æ–ø–∏–π!

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏

```python
# –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
file1 = await service.export_closed_orders_to_excel(30)
stat1 = os.stat(file1)
time1 = stat1.st_mtime  # 22:02:06

# –í—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫
file2 = await service.export_closed_orders_to_excel(30)
stat2 = os.stat(file2)
time2 = stat2.st_mtime  # 22:02:08

# –ü—Ä–æ–≤–µ—Ä–∫–∞
assert file1 == file2  # –û–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∏–º—è ‚úÖ
assert time2 > time1   # –í—Ä–µ–º—è –∏–∑–º–µ–Ω–∏–ª–æ—Å—å ‚úÖ
```

---

## üí° –°–æ–≤–µ—Ç—ã

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á–µ—Ç:

**–í–∞—Ä–∏–∞–Ω—Ç 1:** –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å
```
report_daily.xlsx ‚Üí –û—Ç—á–µ—Ç_–æ–∫—Ç—è–±—Ä—å_2024.xlsx
```

**–í–∞—Ä–∏–∞–Ω—Ç 2:** –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –∞—Ä—Ö–∏–≤
```
reports/ ‚Üí archive/2024/–æ–∫—Ç—è–±—Ä—å/
```

**–í–∞—Ä–∏–∞–Ω—Ç 3:** –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ PDF
```
Excel ‚Üí –§–∞–π–ª ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ ‚Üí PDF
```

### –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤

–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª—ã —Å –¥–∞—Ç–∞–º–∏ –≤ –∏–º–µ–Ω–∏:

```powershell
cd reports
Remove-Item *_????????_??????.xlsx
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª—ã —Ç–∏–ø–∞:
- `report_daily_20251020_123456.xlsx`
- `active_orders_20251020_123456.xlsx`

---

## üéØ –ò—Ç–æ–≥

**–°–∏—Å—Ç–µ–º–∞ –æ—Ç—á–µ—Ç–æ–≤:**
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ –ú–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- ‚úÖ –ß–∏—Å—Ç–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ –£–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

**–ì–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!** üöÄ

---

**–ê–≤—Ç–æ—Ä:** AI Assistant
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 20.10.2025
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0
