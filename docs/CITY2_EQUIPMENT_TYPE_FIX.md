# Исправление статистики по типам техники для city2

## Проблема
Статистика по типам техники работает в city1, но не работает в city2.

## Причина
Миграция `add_equipment_type_to_orders` не была применена для city2, поэтому колонка `equipment_type` отсутствует в таблице `orders` для city2.

## Решение

### Шаг 1: Обновить код на сервере
```bash
cd ~/telegram_repair_bot
git pull
```

### Шаг 2: Применить миграцию для city2
```bash
make mb-migrate-city2
```

Эта команда:
- Остановит контейнер bot_city2
- Пересоберет образ без кэша
- Применит все миграции, включая `add_equipment_type_to_orders`

### Шаг 3: Проверить, что миграция применена
В логах должно быть:
```
[OK] Колонка equipment_type добавлена в таблицу orders
```

### Шаг 4: Перезапустить бота city2
```bash
make mb-start-city2
```

### Шаг 5: Проверить наличие колонки (опционально)
Если нужно проверить наличие колонки вручную, можно использовать скрипт:
```bash
docker compose -f docker/docker-compose.multibot.yml run --rm bot_city2 python scripts/check_equipment_type_column_city2.py
```

## Альтернативное решение (если миграция не применяется)

Если миграция не применяется автоматически, можно добавить колонку вручную:

```bash
# Войти в контейнер city2
docker exec -it telegram_repair_bot_city2 /bin/sh

# Подключиться к базе данных
sqlite3 data/city2/bot_database.db

# Добавить колонку
ALTER TABLE orders ADD COLUMN equipment_type TEXT NOT NULL DEFAULT '';

# Проверить
PRAGMA table_info(orders);

# Выйти
.exit
exit
```

## Проверка

После применения миграции:
1. Сгенерируйте новый отчет для city2
2. Откройте лист "Сводка" в Excel файле
3. Проверьте, что есть секция "По типам техники:" с данными

## Примечания

- Старые отчеты не обновятся автоматически - нужно сгенерировать новый отчет
- Если колонка `equipment_type` пустая для всех заказов, статистика покажет "Не указано" для всех заказов
- Убедитесь, что код обновлен на сервере (включая изменения в `master_reports_detailed.py`)
