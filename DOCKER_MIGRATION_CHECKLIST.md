# –ß–µ–∫-–ª–∏—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ ORMDatabase –¥–ª—è Docker

## üìã –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –º–∏–≥—Ä–∞—Ü–∏–∏

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ ‚úÖ
- [x] ORMDatabase —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] –ú–µ—Ç–æ–¥ `delete_master` –¥–æ–±–∞–≤–ª–µ–Ω
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ SLA –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ –∑–∞—è–≤–æ–∫
- [x] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É –æ –Ω–µ–ø—Ä–∏–Ω—è—Ç—ã—Ö –∑–∞—è–≤–∫–∞—Ö
- [x] –£–±—Ä–∞–Ω–∞ –Ω–∞–¥–ø–∏—Å—å "[MASTER]" –∏–∑ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
- [x] –£–¥–∞–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ö–∞—Å—Ç–æ–º–Ω—ã–π –æ—Ç—á–µ—Ç"
- [x] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ
- [x] –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫

### –§–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- [ ] `app/database/orm_database.py` - –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `delete_master`
- [ ] `app/handlers/admin.py` - –∑–∞–º–µ–Ω–µ–Ω `Database` –Ω–∞ `ORMDatabase`
- [ ] `app/handlers/master.py` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `updated_at` –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ
- [ ] `app/services/scheduler.py` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É
- [ ] `app/handlers/financial_reports.py` - —É–¥–∞–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
- [ ] `docker_migrate.sh` - —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è Docker
- [ ] `DOCKER_MIGRATION_PLAN.md` - –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è Docker
- [ ] `DOCKER_QUICK_DEPLOY.md` - –±—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è Docker

## üê≥ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ Docker

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
- [ ] –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å docker-compose.yml
- [ ] –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –ë–î: `docker-compose exec bot cp /app/data/bot_database.db /app/data/bot_database_backup_$(date +%Y%m%d_%H%M%S).db`

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
- [ ] –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞: `docker-compose stop bot`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ (git pull –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤)
- [ ] –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑: `docker-compose build bot` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### 3. –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç: `./docker_migrate.sh`
- [ ] –ò–õ–ò –≤—Ä—É—á–Ω—É—é: `docker-compose run --rm bot alembic upgrade head`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å: `docker-compose run --rm bot alembic current`

### 4. –ó–∞–ø—É—Å–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞: `docker-compose up -d bot`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å: `docker-compose ps`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `docker-compose logs -f bot`

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
- [ ] –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞
- [ ] –ü—Ä–∏–Ω—è—Ç–∏–µ –∑–∞—è–≤–∫–∏ –º–∞—Å—Ç–µ—Ä–æ–º
- [ ] –ü–µ—Ä–µ–Ω–æ—Å –∑–∞—è–≤–∫–∏ (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ SLA)
- [ ] –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] –£–≤–æ–ª—å–Ω–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞ (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫)
- [ ] –ê–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –º–∞—Å—Ç–µ—Ä–∞
- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–æ–≤ (–±–µ–∑ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞)

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–µ–ø—Ä–∏–Ω—è—Ç—ã—Ö –∑–∞—è–≤–∫–∞—Ö (–º–∞—Å—Ç–µ—Ä—É –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É)
- [ ] SLA-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–±–µ–∑ –Ω–∞–¥–ø–∏—Å–∏ "[MASTER]")
- [ ] –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –≤–∏–∑–∏—Ç–∞—Ö

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Docker

### –õ–æ–≥–∏
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ `AttributeError: 'ORMDatabase' object has no attribute 'delete_master'`
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- [ ] –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–æ—Ç–∞ –∑–∞–ø—É—â–µ–Ω: `docker-compose ps`
- [ ] –ù–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤ –Ω–æ—Ä–º–µ: `docker stats`

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- [ ] –ë–î –¥–æ—Å—Ç—É–ø–Ω–∞: `docker-compose exec bot sqlite3 /app/data/bot_database.db "SELECT 1;"`
- [ ] –¢–∞–±–ª–∏—Ü—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç: `docker-compose exec bot sqlite3 /app/data/bot_database.db ".tables"`
- [ ] –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã: `docker-compose exec bot sqlite3 /app/data/bot_database.db "SELECT COUNT(*) FROM orders;"`

## üÜò –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞ –¥–ª—è Docker

### –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
- [ ] –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ: `docker-compose down`
- [ ] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±—ç–∫–∞–ø: `docker-compose run --rm bot cp /app/data/bot_database_backup_YYYYMMDD_HHMMSS.db /app/data/bot_database.db`
- [ ] –û—Ç–∫–∞—Ç–∏—Ç—å –∫–æ–¥: `git checkout HEAD~1`
- [ ] –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑: `docker-compose build bot`
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞: `docker-compose up -d bot`

## üìû –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏

### –õ–æ–≥–∏
```bash
# –õ–æ–≥–∏ –±–æ—Ç–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f bot

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤
docker-compose logs --tail=100 bot

# –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose logs -f
```

### –°—Ç–∞—Ç—É—Å
```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker inspect $(docker-compose ps -q bot)
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
docker-compose exec bot sqlite3 /app/data/bot_database.db

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã
docker-compose exec bot sqlite3 /app/data/bot_database.db ".tables"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ö–µ–º—É
docker-compose exec bot sqlite3 /app/data/bot_database.db ".schema orders"
```

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

- [ ] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
- [ ] –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- [ ] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –Ω–æ—Ä–º–µ
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –∂–∞–ª—É—é—Ç—Å—è
- [ ] –ë—ç–∫–∞–ø —Å–æ—Ö—Ä–∞–Ω–µ–Ω
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

## üê≥ Docker-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] –û–±—Ä–∞–∑ –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –¢–æ–º —Å –¥–∞–Ω–Ω—ã–º–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –°–µ—Ç—å –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–æ—Ä—Ç—ã –ø—Ä–æ–±—Ä–æ—à–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

**–î–∞—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏:** ___________
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** ___________
**–°—Ç–∞—Ç—É—Å:** ___________
**Docker –≤–µ—Ä—Å–∏—è:** ___________
