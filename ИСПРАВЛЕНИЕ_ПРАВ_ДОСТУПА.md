# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

## ‚ùå –û—à–∏–±–∫–∞
```
PermissionError: [Errno 13] Permission denied: '/app/logs/bot.log'
```

## ‚úÖ –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ù–ê –°–ï–†–í–ï–†–ï

### –°–ø–æ—Å–æ–± 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
cd /path/to/telegram_repair_bot

# –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x scripts/fix_permissions.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
./scripts/fix_permissions.sh

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
make prod-stop
make prod-start
```

### –°–ø–æ—Å–æ–± 2: –í—Ä—É—á–Ω—É—é

```bash
cd /path/to/telegram_repair_bot

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose -f docker/docker-compose.prod.yml down

# –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
mkdir -p data logs backups data/redis

# –í–ê–†–ò–ê–ù–¢ A: –ò–∑–º–µ–Ω–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ –Ω–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo chown -R $(id -u):$(id -g) data/ logs/ backups/
chmod -R 755 data logs backups

# –í–ê–†–ò–ê–ù–¢ B: –î–∞—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤—Å–µ–º (–º–µ–Ω–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ)
sudo chmod -R 777 data/ logs/ backups/

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
docker compose -f docker/docker-compose.prod.yml up -d --build
```

### –°–ø–æ—Å–æ–± 3: –î–ª—è UID 1000 (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å botuser –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)

```bash
# –ò–∑–º–µ–Ω–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ –Ω–∞ UID 1000 (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)
sudo chown -R 1000:1000 data/ logs/ backups/

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
make prod-start
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞
ls -lh | grep -E "data|logs|backups"

# –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
# drwxr-xr-x  youruser yourgroup  data/
# drwxr-xr-x  youruser yourgroup  logs/
# drwxr-xr-x  youruser yourgroup  backups/

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞
docker logs telegram_repair_bot_prod --tail 50
```

---

## üì¶ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤, –æ–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞:

```bash
# –ü–æ–ª—É—á–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Dockerfile
git pull

# –ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Ä—É—á–Ω—É—é:
# - docker/Dockerfile (–æ–±–Ω–æ–≤–ª–µ–Ω - —Å–æ–∑–¥–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ logs –∏ backups)
# - docker/docker-compose.prod.yml (–æ–±–Ω–æ–≤–ª–µ–Ω - bind mounts)
# - Makefile (–æ–±–Ω–æ–≤–ª–µ–Ω - –±–µ–∑–æ–ø–∞—Å–Ω—ã–π prod-clean)
```

---

## üõ°Ô∏è –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `Dockerfile` —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏:

```dockerfile
# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
RUN useradd -m -u 1000 botuser && \
    mkdir -p /app /app/data /app/logs /app/backups && \
    chown -R botuser:botuser /app
```

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Dockerfile:

```bash
# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
docker compose -f docker/docker-compose.prod.yml build --no-cache

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
make prod-start
```

---

## üÜò –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ñ–∞–π–ª–æ–≤ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
docker exec telegram_repair_bot_prod ls -la /app/
docker exec telegram_repair_bot_prod id
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å bind mounts

```bash
docker inspect telegram_repair_bot_prod | grep -A 20 Mounts
```

### 3. –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose -f docker/docker-compose.prod.yml down

# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã
docker image rm telegram_repair_bot_prod telegram-repair-bot-bot 2>/dev/null || true

# –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞
sudo chown -R $(id -u):$(id -g) data/ logs/ backups/

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Å –Ω—É–ª—è
docker compose -f docker/docker-compose.prod.yml build --no-cache

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
docker compose -f docker/docker-compose.prod.yml up -d
```

---

## üìû –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# –£–∑–Ω–∞—Ç—å UID —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
id -u

# –£–∑–Ω–∞—Ç—å UID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 1000)
docker run --rm python:3.11-slim sh -c "id -u"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
ls -ln data/ logs/ backups/

# –ï—Å–ª–∏ UID –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç - –∏–∑–º–µ–Ω–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞
sudo chown -R 1000:1000 data/ logs/ backups/
```
