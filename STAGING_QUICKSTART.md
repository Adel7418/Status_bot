# üöÄ Staging Workflow - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω Makefile** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã –¥–ª—è staging/prod
2. **–°–æ–∑–¥–∞–Ω docker-compose.staging.yml** - –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
3. **–°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è**
4. **–ù–∞–ø–∏—Å–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**

## üìã –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (5 –º–∏–Ω—É—Ç)

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ª–æ–∫–∞–ª—å–Ω–æ)

**Windows PowerShell:**
```powershell
$env:SSH_SERVER="root@–≤–∞—à-IP-–∞–¥—Ä–µ—Å"
```

**–ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:**
```env
SSH_SERVER=root@–≤–∞—à-IP-–∞–¥—Ä–µ—Å
STAGING_DIR=~/telegram_repair_bot_staging
PROD_DIR=~/telegram_repair_bot
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ staging –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–æ–¥–∏–Ω —Ä–∞–∑)

```bash
# SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh root@–≤–∞—à-IP-–∞–¥—Ä–µ—Å

# –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é staging
cd ~
git clone https://github.com/–≤–∞—à-username/telegram_repair_bot.git telegram_repair_bot_staging
cd telegram_repair_bot_staging

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env.staging —Å –¢–ï–°–¢–û–í–´–ú —Ç–æ–∫–µ–Ω–æ–º
cp env.staging.example .env.staging
nano .env.staging
# –£–∫–∞–∂–∏—Ç–µ –¢–ï–°–¢–û–í–´–ô —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (—Å–æ–∑–¥–∞–π—Ç–µ —É @BotFather)
```

## üîÑ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞:

```bash
# 1. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤ Cursor
make test && make lint
git add . && git commit -m "feat: –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è"
git push origin main

# 2. –î–µ–ø–ª–æ–π –≤ staging (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
make staging-deploy
make staging-logs

# 3. –ï—Å–ª–∏ –≤—Å—ë –û–ö - –¥–µ–ø–ª–æ–π –≤ production
make prod-deploy
make prod-status
```

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
make test              # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
make lint              # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥
make run               # –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ

# Staging
make staging-deploy    # –î–µ–ø–ª–æ–π –≤ staging
make staging-logs      # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

# Production
make prod-deploy       # –î–µ–ø–ª–æ–π –≤ production (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º!)
make prod-logs         # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
make prod-status       # –°—Ç–∞—Ç—É—Å –∏ –º–µ—Ç—Ä–∏–∫–∏

# –í—Å—è —Å–ø—Ä–∞–≤–∫–∞
make help              # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã
```

## üìñ –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[docs/STAGING_WORKFLOW.md](docs/STAGING_WORKFLOW.md)** - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- **[docs/STAGING_SETUP_REPORT.md](docs/STAGING_SETUP_REPORT.md)** - –û—Ç—á—ë—Ç –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- **[scripts/README.md](scripts/README.md)** - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- ‚úÖ **–í—Å–µ–≥–¥–∞** —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ staging –ø–µ—Ä–µ–¥ production
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–†–ê–ó–ù–´–ï —Ç–æ–∫–µ–Ω—ã** –¥–ª—è staging –∏ production
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `make prod-deploy` —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è backup –ë–î –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [docs/STAGING_WORKFLOW.md](docs/STAGING_WORKFLOW.md) - —Ä–∞–∑–¥–µ–ª Troubleshooting
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `SSH_SERVER` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ: `ssh root@your-ip "echo OK"`

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ

