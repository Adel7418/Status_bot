# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º—ã "–ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã"

## –ü—Ä–æ–±–ª–µ–º–∞
–ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–ª –Ω–∞ –∫–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

### üîç –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤
1. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:** `RuntimeWarning: coroutine 'on_startup' was never awaited`
2. **Updates –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è:** –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏, —á—Ç–æ updates –ø–æ–ª—É—á–∞—é—Ç—Å—è (Duration 1-5 ms)
3. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç:** –ù–µ—Ç –ª–æ–≥–æ–≤ –æ—Ç —Å–∞–º–∏—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥

### ‚ùå –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã
–í —Ñ–∞–π–ª–µ `bot.py` —Ñ—É–Ω–∫—Ü–∏–∏ `on_startup` –∏ `on_shutdown` —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:

```python
# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
dp.startup.register(lambda: on_startup(bot, db, scheduler))
dp.shutdown.register(lambda: on_shutdown(bot, db, scheduler))
```

–ü—Ä–æ–±–ª–µ–º–∞ –∑–∞–∫–ª—é—á–∞–ª–∞—Å—å –≤ —Ç–æ–º, —á—Ç–æ:
1. –õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–ª–∞ –∫–æ—Ä—É—Ç–∏–Ω—É, –Ω–æ –Ω–µ –≤—ã–∑—ã–≤–∞–ª–∞ –µ—ë
2. –ö–æ—Ä—É—Ç–∏–Ω–∞ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å (never awaited)
3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –º–æ–≥–ª–∞ –Ω–µ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. Middleware –º–æ–≥–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## –†–µ—à–µ–Ω–∏–µ

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ on_startup

```python
# –ë–´–õ–û:
dp.startup.register(lambda: on_startup(bot, db, scheduler))
dp.shutdown.register(lambda: on_shutdown(bot, db, scheduler))

# –°–¢–ê–õ–û:
# –í—ã–∑–æ–≤ startup —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
await on_startup(bot, db, scheduler)

# –ò –≤ –±–ª–æ–∫–µ finally:
finally:
    # –í—ã–∑–æ–≤ shutdown —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
    await on_shutdown(bot, db, scheduler)
    await bot.session.close()
```

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–æ –±–æ–ª—å—à–µ –ª–æ–≥–æ–≤ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `/start` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

```python
@router.message(CommandStart())
@handle_errors
async def cmd_start(message: Message, user: User, user_role: str):
    logger.info(f"START command received from user {message.from_user.id}")
    logger.info(f"User role: {user_role}, User object: {user}")
    
    # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
    
    logger.info(f"Sending welcome message...")
    await message.answer(welcome_text, reply_markup=get_main_menu_keyboard(user_role))
    logger.info(f"User {message.from_user.id} ({user_role}) started the bot")
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **–§—É–Ω–∫—Ü–∏—è on_startup** —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á** –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **Middleware** —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤** –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

### ‚úÖ –õ–æ–≥–∏ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
```
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- –ü–æ–¥–∫–ª—é—á–µ–Ω–æ 4 —Ä–æ—É—Ç–µ—Ä–æ–≤
- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á –∑–∞–ø—É—â–µ–Ω
- –ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω!
- –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞...
- Start polling
- Run polling for bot @Karinasell_Bot id=7621937754
```

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### üß™ –¢–µ—Å—Ç 1: –ö–æ–º–∞–Ω–¥–∞ /start
1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram: @Karinasell_Bot
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start`
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** 
   - –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - –ü–æ–∫–∞–∑–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
   - –í –ª–æ–≥–∞—Ö –ø–æ—è–≤—è—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è: "START command received from user..."

### üß™ –¢–µ—Å—Ç 2: –ö–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É"
1. –ü–æ—Å–ª–µ `/start` –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "‚ûï –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É"
2. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å —Ç–∏–ø–∞–º–∏ —Ç–µ—Ö–Ω–∏–∫–∏
   - –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è

### üß™ –¢–µ—Å—Ç 3: –î—Ä—É–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã
- `/help` - –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
- "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏" - –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
- "‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è" - –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∏—Å—Ç–µ–º–µ

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

### üìä –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
```powershell
# Windows PowerShell:
Get-Content bot.log -Tail 50

# –ò–ª–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:
Get-Content bot.log -Wait -Tail 10
```

### üìù –ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö
- ‚úÖ `START command received from user XXXXXXX`
- ‚úÖ `User role: ADMIN` (–∏–ª–∏ –¥—Ä—É–≥–∞—è —Ä–æ–ª—å)
- ‚úÖ `Sending welcome message...`
- ‚úÖ `Update id=XXXXXX is handled. Duration X ms`

### ‚ùå –ü—Ä–∏–∑–Ω–∞–∫–∏ –ø—Ä–æ–±–ª–µ–º—ã
- ‚ùå `RuntimeWarning: coroutine 'on_startup' was never awaited`
- ‚ùå –ù–µ—Ç –ª–æ–≥–æ–≤ –æ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- ‚ùå –¢–æ–ª—å–∫–æ `Update is handled` –±–µ–∑ –¥—Ä—É–≥–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `bot.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è startup/shutdown —Ñ—É–Ω–∫—Ü–∏–π
- `app/handlers/common.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### üîß –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã
1. **–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞:**
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ middleware
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤
   - **–í—ã–∑–æ–≤ on_startup** (–æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∞–¥–º–∏–Ω–∞–º, –∑–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞)
   - –ó–∞–ø—É—Å–∫ polling

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥:**
   - –ü–æ–ª—É—á–µ–Ω–∏–µ update –æ—Ç Telegram
   - –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ middleware (RoleCheckMiddleware)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Ä–æ—É—Ç–µ—Ä–æ–≤
   - –í—ã–∑–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

3. **–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞:**
   - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ polling
   - **–í—ã–∑–æ–≤ on_shutdown** (–æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∞–¥–º–∏–Ω–∞–º, –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞)
   - –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î

### üõ°Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ INFO –¥–ª—è –≤—Å–µ—Ö –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä @handle_errors
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ

## –°—Ç–∞—Ç—É—Å

### ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
–ü—Ä–æ–±–ª–µ–º–∞ —Å –≤—ã–∑–æ–≤–æ–º –∫–æ—Ä—É—Ç–∏–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞. –ë–æ—Ç —Ç–µ–ø–µ—Ä—å:
- ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**
- ‚úÖ **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º**
- ‚úÖ **–ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á**
- ‚úÖ **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
- ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è**

### üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –±–æ—Ç–∞**, –æ—Ç–ø—Ä–∞–≤–∏–≤ `/start`
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏**, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç–µ
3. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É** –¥–ª—è –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

**–ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### üìû –ï—Å–ª–∏ –±–æ—Ç –≤—Å—ë –µ—â—ë –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω: `tasklist | findstr python`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫: `Get-Content bot.log -Tail 50`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å —Ä–æ–ª—å –≤ –ë–î
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ TOKEN –≤ .env —Ñ–∞–π–ª–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π

### üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
```powershell
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞:
taskkill /F /IM python.exe

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ:
python bot.py
```

### üìß –ü–æ–¥–¥–µ—Ä–∂–∫–∞
–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å TOKEN
- –ù–∞–ª–∏—á–∏–µ –ø—Ä–∞–≤ —É –±–æ—Ç–∞ –≤ Telegram
- –õ–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥—Ä—É–≥–∏—Ö –æ—à–∏–±–æ–∫
